experiment:
  name: "Full Context (T=0.2, Reasoning=High)"
  author: "Xiaosong"
  notes: "v0.3.4 with all improvements: victim role + indicators + self-defense + strict criteria, temp=0.2, reasoning=high"

model:
  name: "mlx-community/gpt-oss-120b"
  provider: "mlx"
  api_url: "http://localhost:1234/v1/chat/completions"
  temperature: 0.2

prompt:
  version: "v0.3.4_context"
  system_prompt: |
    Reasoning: high

    ROLE: You are an expert trained to detect if the deceased was a victim of intimate partner violence (IPV) from law enforcement and medical examiner reports following a suicide.

    DEFINITION: IPV occurs only when the abusive behavior listed below is committed by a current or former intimate partner, boyfriend, girlfriend, spouse, or ex, or father of victim's children. Abuse by other people (friends, peers, strangers, or family members not in an intimate relationship) does not qualify as IPV.

    TYPES OF IPV ABUSE:
    1. PHYSICAL ABUSE: hitting, slapping, pushing, choking, biting, pulling hair, poisoning, giving incorrect doses of meds, strangulation, beating
    2. SEXUAL ABUSE: forcible rape, coerced sex, sexual exploitation, refusal to use protection, forced pregnancy/abortion
    3. PSYCHOLOGICAL ABUSE: verbal threats, stalking, intimidation (reckless driving, screaming at victimized partner's face, treat victimized partner as inferior), jealous or suspicious of friends/opposite sex, made financial decisions without talking to victimized partner, restricting phone use, blamed victimized partner for abusive partners problems
    4. EMOTIONAL ABUSE: gaslighting, lying, providing misinformation, withholding information, isolation (telling victim not to tell anyone about what's happening, not allow victim to socialize, silent treatment), humiliation, using children against victimized partner, sharing intimate nude photos of victimized partner to others without their knowledge
    5. ECONOMIC ABUSE: control access to money, control access to means of transportation, control whether victimized partner goes to work/school, ruins credit, spends or gambles victimized partners money
    6. LEGAL ABUSE: threat to call police on victimized partner, use court system against victimized partner (i.e. custody change), threaten to call child services, immigration or other governmental agencies

    INDIRECT IPV INDICATORS (Strong Evidence):
    - Women's shelter stay (e.g., Family Violence Project) → AUTOMATIC IPV
    - Police separation/intervention in partner relationship → HIGH IPV probability
    - Restraining order against partner → HIGH IPV probability
    - "Domestic issues" or "domestic violence" mentioned → Likely IPV
    - Partner arrested for DV → HIGH IPV probability

    EXCLUSION CRITERIA (NOT IPV):
    - Deceased initiated violence AND partner restrained/defended = Self-defense, NOT IPV
    - Mutual combat (both violent, no clear victim) = NOT IPV
    - Deceased was perpetrator, not victim = NOT IPV
    - Homicide victim (not suicide) = NOT IPV for this study
    - Breakups, arguments, sadness alone = NOT IPV

    CRITICAL CHECKS:
    - Deceased must be suicide victim (self-inflicted death)
    - Deceased must be IPV victim (abused BY partner)
    - Require explicit evidence or strong indirect indicators
    - When uncertain, default to FALSE

  user_template: |
    TASK: Comprehensive IPV assessment with full context.

    Step 1: Confirm this is a suicide (self-inflicted), not homicide
    Step 2: Check INDIRECT indicators first (shelter, police, restraining orders, domestic issues)
    Step 3: Identify who was the aggressor/victim
    Step 4: If deceased attacked partner → check if partner's response was self-defense
    Step 5: Look for explicit abuse BY partner AGAINST deceased
    Step 6: Final determination (when uncertain → FALSE)

    Narrative: <<TEXT>>

    Return valid JSON (examples):
    {"detected": true, "confidence": 0.85, "indicators": ["domestic violence history"], "rationale": "..."}
    {"detected": false, "confidence": 0.9, "indicators": [], "rationale": "..."}

    Rules:
    - confidence must be a number: 0.9, 0.75, 0.85
    - Never spell out: "0. nine" is INVALID

    Required format:
    {
      "detected": true/false,
      "confidence": 0.00-1.00,
      "indicators": ["exact tokens from vocab list"],
      "rationale": "≤200 char fact-based explanation"
    }

data:
  file: "data-raw/suicide_IPV_manuallyflagged.xlsx"

run:
  seed: 1024
  max_narratives: 1000000
  save_incremental: true
  save_csv_json: true
