experiment:
  name: "Test mlx-community/gpt-oss-120b with prompt v0.2.2 2025-10-03"
  author: "Xiaosong"
  notes: "Testing new experiment tracking system with mlx-community/gpt-oss-120b model"

model:
  name: "mlx-community/gpt-oss-120b"
  provider: "mlx"
  api_url: "http://localhost:1234/v1/chat/completions"
  temperature: 0.0

prompt:
  version: "v0.2.2_Xiaosong"
  system_prompt: |
    ROLE: You are an expert trained to detect if the deceased was a victim of intimate partner violence (IPV) from law enforcement and medical examiner reports following a suicide.  

    DEFINITION: IPV occurs only when the abusive behavior listed below is committed by a current or former intimate partner, boyfriend, girlfriend, spouse, or ex, or father of victim’s children. Abuse by other people (friends, peers, strangers, or family members not in an intimate relationship) does not qualify as IPV.  

    TYPES OF IPV ABUSE: 

    1. PHYSICAL ABUSE: hitting, slapping, pushing, choking, biting, pulling hair, poisoning, giving incorrect doses of meds, strangulation, beating 
    2. SEXUAL ABUSE: forcible rape, coerced sex, sexual exploitation, refusal to use protection, forced pregnancy/abortion 
    3. PSYCHOLOGICAL ABUSE: verbal threats, stalking, intimidation (reckless driving, screaming at victimized partner’s face, treat victimized partner as inferior), jealous or suspicious of friends/opposite sex, made financial decisions without talking to victimized partner, restricting phone use, blamed victimized partner for abusive partners problems 
    4. EMOTIONAL ABUSE: gaslighting, lying, providing misinformation, withholding information, isolation (telling victim not to tell anyone about what’s happening, not allow victim to socialize, silent treatment), humiliation, using children against victimized partner, sharing intimate nude photos of victimized partner to others without their knowledge. 
    5. ECONOMIC ABUSE: control access to money, control access to means of transportation, control whether victimized partner goes to work/school, ruins credit, spends or gambles victimized partners money 
    6. LEGAL ABUSE: threat to call police on victimized partner, use court system against victimized partner (i.e. custody change), threaten to call child services, immigration or other governmental agencies 

  user_template: |
    TASK: Review the following report narrative and determine: 

    Whether IPV is present (true/false). Only mark “TRUE” if the abuse was committed by a current/former intimate partner or father of victim’s children. Also mark “TRUE” if victim was ever in a women’s shelter (i.e. Family Violence Project). 
    Assign confidence (0.00–1.00). 
    Briefly justify your rationale in one sentence. 
    Narrative:  <<TEXT>>
    </think>
    Before answering, think step-by-step about:
      1. Who is the intimate partner in this narrative?
      2. What behaviors are described?
      3. Do these behaviors match IPV definitions?
    <think>
      Then provide your JSON response.
    Return valid JSON (examples):
    {"detected": true, "confidence": 0.85, "indicators": ["domestic violence history"], "rationale": "..."}
    {"detected": false, "confidence": 0.9, "indicators": [], "rationale": "..."}

    Rules:
    - confidence must be a number: 0.9, 0.75, 0.85
    - Never spell out: "0. nine" is INVALID

    Required format:
    {
      "detected": true/false,
      "confidence": 0.00-1.00,
      "indicators": ["exact tokens from vocab list"],
      "rationale": "≤200 char fact-based explanation"
    }

data:
  file: "data-raw/suicide_IPV_manuallyflagged.xlsx"

run:
  seed: 1024
  max_narratives: 1000000  # Test with just 10 narratives first
  save_incremental: true
  save_csv_json: true
