experiment:
  name: "Strict Criteria + Self-Defense (T=0.2, Reasoning=High) - Qwen3-80B"
  author: "gemini"
  notes: "Replication of exp-015 with qwen3-next-80b-a3b-thinking-mlx"

model:
  name: "qwen3-next-80b-a3b-thinking-mlx"
  provider: "mlx"
  api_url: "http://localhost:1234/v1/chat/completions"
  temperature: 0.2

prompt:
  version: "v0.3.3_strict"
  system_prompt: |
    Reasoning: high

    ROLE: You are an expert trained to detect if the deceased was a victim of intimate partner violence (IPV) from law enforcement and medical examiner reports following a suicide.

    DEFINITION: IPV occurs only when the abusive behavior listed below is committed by a current or former intimate partner, boyfriend, girlfriend, spouse, or ex, or father of victim's children. Abuse by other people (friends, peers, strangers, or family members not in an intimate relationship) does not qualify as IPV.

    TYPES OF IPV ABUSE:
    1. PHYSICAL ABUSE: hitting, slapping, pushing, choking, biting, pulling hair, poisoning, giving incorrect doses of meds, strangulation, beating
    2. SEXUAL ABUSE: forcible rape, coerced sex, sexual exploitation, refusal to use protection, forced pregnancy/abortion
    3. PSYCHOLOGICAL ABUSE: verbal threats, stalking, intimidation (reckless driving, screaming at victimized partner's face, treat victimized partner as inferior), jealous or suspicious of friends/opposite sex, made financial decisions without talking to victimized partner, restricting phone use, blamed victimized partner for abusive partners problems
    4. EMOTIONAL ABUSE: gaslighting, lying, providing misinformation, withholding information, isolation (telling victim not to tell anyone about what's happening, not allow victim to socialize, silent treatment), humiliation, using children against victimized partner, sharing intimate nude photos of victimized partner to others without their knowledge
    5. ECONOMIC ABUSE: control access to money, control access to means of transportation, control whether victimized partner goes to work/school, ruins credit, spends or gambles victimized partners money
    6. LEGAL ABUSE: threat to call police on victimized partner, use court system against victimized partner (i.e. custody change), threaten to call child services, immigration or other governmental agencies

    STRICT EXCLUSION CRITERIA (NOT IPV):
    - Deceased initiated violence AND partner restrained/defended = Self-defense, NOT IPV
    - Mutual combat (both violent, no clear victim) = NOT IPV
    - Deceased was perpetrator, not victim = NOT IPV
    - Homicide victim (not suicide) = NOT IPV for this study
    - Single argument without abuse pattern = NOT IPV

    REQUIRE CLEAR EVIDENCE:
    - Must have explicit abuse BY partner AGAINST deceased
    - Breakups, arguments, sadness alone = NOT IPV
    - When uncertain, default to FALSE

  user_template: |
    TASK: Determine if the deceased was a victim of IPV using strict criteria.

    Step 1: Was this a suicide (self-inflicted death)? If homicide, mark FALSE
    Step 2: Who initiated violence? If deceased attacked partner first, likely self-defense
    Step 3: Check for abuse BY partner AGAINST deceased (not vice versa)
    Step 4: Verify evidence is explicit, not implied
    Step 5: Women's shelter = AUTO TRUE
    Step 6: Final determination

    Narrative: <<TEXT>>

    Return valid JSON (examples):
    {"detected": true, "confidence": 0.85, "indicators": ["domestic violence history"], "rationale": "..."}
    {"detected": false, "confidence": 0.9, "indicators": [], "rationale": "..."}

    Rules:
    - confidence must be a number: 0.9, 0.75, 0.85
    - Never spell out: "0. nine" is INVALID

    Return this EXACT JSON structure:
    {
      "detected": <boolean>,          // true or false
      "confidence": <number>,          // decimal 0.0 to 1.0, e.g., 0.85
      "rationale": <string>            // max 200 characters
    }

    Valid confidence examples:
    - "confidence": 0.9   ✓
    - "confidence": 0.75  ✓
    - "confidence": 0.85  ✓

    Invalid (DO NOT USE):
    - "confidence": 0. nine  ✗ (never spell numbers)
    - "confidence": "0.9"    ✗ (must be number, not string)

    Your response must be valid JSON parseable by JSON.parse()

data:
  file: "data-raw/suicide_IPV_manuallyflagged.xlsx"

run:
  seed: 1024
  max_narratives: 1000000
  save_incremental: true
  save_csv_json: true
